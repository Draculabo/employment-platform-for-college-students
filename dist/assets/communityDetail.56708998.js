import{s as J,o as X}from"./element-plus.33eaa91b.js";import{i as V,a as Y,f as Z,n as N,U as j,E as ee,H as te,B as oe}from"./browseHistory.201587b8.js";import{r as g,C as b,o as m,c as _,a as n,I as ne,aj as se,u as t,U as ue,z as ie,O as k,K as I,at as Q,au as S,R as y,T as v,a4 as B,L,a3 as H,W as U,ar as z,w as K,a1 as ae,p as M,M as le,P as q}from"./@vue.fc97fa33.js";import{P as re}from"./vue3-emoji-picker.e37bcf1c.js";import{b as F,u as T,w as x,s as O,e as $,i as ce}from"./index.e95f406b.js";import{e as W}from"./@vueuse.ab7095fd.js";import{_ as E,V as me}from"./vue-markdown-menu-bar.ed0bbcd3.js";import{b as de}from"./vue-router.68db326f.js";import{b as pe,l as _e}from"./community.fc721f69.js";/* empty css                  */import"./@element-plus.e79cb38e.js";import"./dayjs.6d6bf3b5.js";import"./aos.e37f4dc9.js";import"./lodash-es.2fa8789e.js";import"./@ctrl.82a509e0.js";import"./async-validator.fb49d0f5.js";import"./jspdf.93f2685e.js";import"./@babel.2898e469.js";import"./fflate.fca59393.js";import"./pinia.a56e7d9e.js";import"./vue-demi.b3a9cad9.js";import"./picture-verification-code.e81ffd11.js";import"./axios.754b77ca.js";import"./form-data.2b153385.js";import"./nprogress.8e3ae131.js";function fe(e){return F("/communityComment/publish",e)}function he(e){return F("/communityComment/reply",e)}function ye(e){return F("/communityComment/remove",e)}function ve(e){return F("/communityComment/queryCommentsByArticleId",e)}function Ie(e){const o=g(!1);function u(){o.value=!o.value}function l(a){u(),e.value+=a.i}return{picker:o,togglePicker:u,setEmoji:l}}function Ce(e,o,u,l,a){const c=g(""),{loginState:r,loginModelToggle:d,userInfo:f}=T();async function s(){if(!r.logined){d();return}if(!c.value.trim()){x("\u4F60\u53D1\u4E2A\u7A7A\u5185\u5BB9\u662F\u60F3\u5E72\u561B\u5462\uFF1F\uFF1F\uFF1F");return}if(c.value.length>200){x("\u592A\u591A\u4E86\u5B58\u4E0D\u4E0B, \u5220\u5230200\u5B57\u4EE5\u5185\u5427");return}const i=o==1?fe:he,p={content:c.value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),authorId:f.uid,level:o,articleId:e,posterCommentId:u,replyAuthorId:l},h=await i(p);h.code==200&&(c.value="",a("reQueryComments")),h.code==200?O(h.msg):$(h.msg)}return{shareMainContent:c,publish:W(s,1e3)}}const ge=e=>(Q("data-v-06d8d149"),e=e(),S(),e),ke={class:"community-publish content-card"},$e={class:"community-content-edit"},be={class:"community-operator-group flex community-content-edit-publish"},Ee={class:"community-edit-picker"},Be=ge(()=>n("i",{class:"iconfont icon-emoji font-25"},null,-1)),Fe=[Be],Te=b({__name:"publish",props:{articleId:null,level:null,posterCommentId:null,replyAuthorId:null,background:{default:"#f8f8f8"}},emits:["reQueryComments"],setup(e,{emit:o}){const u=e,{shareMainContent:l,publish:a}=Ce(u.articleId,u.level,u.posterCommentId||0,u.replyAuthorId||0,o),{picker:c,setEmoji:r,togglePicker:d}=Ie(l);return(f,s)=>(m(),_("div",ke,[n("div",$e,[ne(n("textarea",{style:ue({background:e.background}),class:"content-edit main-content","onUpdate:modelValue":s[0]||(s[0]=i=>ie(l)?l.value=i:null),placeholder:"\u5185\u5BB9\u63A7\u5236\u5728200\u5B57\u4EE5\u5185\uFF5E"},null,4),[[se,t(l)]])]),n("div",be,[n("div",Ee,[n("span",{class:"emoji pointer",onClick:s[1]||(s[1]=(...i)=>t(d)&&t(d)(...i))},Fe),t(c)?(m(),k(t(re),{key:0,class:"picker",native:!0,"hide-search":!0,"hide-group-names":!0,onSelect:t(r),"static-texts":{skinTone:"\u6362\u80A4"}},null,8,["onSelect"])):I("",!0)]),n("button",{class:"btn primary",onClick:s[2]||(s[2]=(...i)=>t(a)&&t(a)(...i))},"\u53D1\u8868")])]))}});const R=E(Te,[["__scopeId","data-v-06d8d149"]]);function G(e){const{userInfo:o}=T(),u=g(-1);let l=-1;function a(r){if(l===r){u.value=-1,l=-1;return}l=r,u.value=r}async function c(r,d,f){if(!V()){$("\u8BF7\u5148\u767B\u5F55\uFF01"),window.location.reload();return}const s=await ye({commentId:r,articleId:d,level:f});if(s.code==200){O(s.msg),e("reQueryComments");return}$(s.msg)}return{userInfo:o,reply:a,remove:c,currenId:u}}function De(e){const o=g(e>1);function u(){o.value=!1}return{more:o,setMore:u}}const Ae=e=>(Q("data-v-e540ab29"),e=e(),S(),e),we={class:"user-head"},Me=["src"],Ne={class:"user-info"},xe={class:"user-name"},Qe={class:"date-school"},Se={key:0,class:"datetime mr-20"},Re={class:"school"},Pe=Ae(()=>n("i",{class:"iconfont icon-school"},null,-1)),Ue=b({__name:"UserInfo",props:{userInfo:null,publishTime:null},setup(e){return(o,u)=>{var l,a,c,r;return m(),_("div",we,[n("img",{class:"pointer mr-10",src:(l=e.userInfo)==null?void 0:l.avatar},null,8,Me),y(Y,{class:"user-tooltip",userInfo:e.userInfo},null,8,["userInfo"]),n("div",Ne,[n("span",xe,v((a=e.userInfo)==null?void 0:a.nickName),1),n("div",Qe,[e.publishTime?(m(),_("span",Se,v(t(Z)(e.publishTime))+"\u53D1\u5E03",1)):I("",!0),n("span",Re,[Pe,B(" "+v((c=e.userInfo)==null?void 0:c.school)+" - "+v((r=e.userInfo)==null?void 0:r.graduation)+"\u5C4A ",1)])])])])}}});const qe=E(Ue,[["__scopeId","data-v-e540ab29"]]),Ve={class:"comments-list mt-20 content-card"},je={class:"comment-item"},Le={class:"comment-content line-4"},He={class:"reply-text pointer"},ze={class:"list-style-init flex operator"},Ke=["onClick"],Oe=["onClick"],We=b({__name:"reply",props:{data:null,commentId:null,articleId:null},emits:["reQueryComments"],setup(e,{emit:o}){const u=e,{currenId:l,reply:a,userInfo:c,remove:r}=G(o),{more:d,setMore:f}=De(u.data.length);return(s,i)=>(m(),_("div",Ve,[(m(!0),_(L,null,H(t(d)?e.data.slice(0,1):e.data,p=>(m(),_("div",je,[y(qe,{"user-info":p.authorInfo,"publish-time":p.createTime},null,8,["user-info","publish-time"]),n("p",Le,[n("span",He,"@"+v(p.replyNickName)+"\uFF1A",1),B(" "+v(p.content),1)]),n("ul",ze,[n("li",{class:"mr-10",onClick:h=>t(a)(p.commentId)},"\u56DE\u590D",8,Ke),t(c).uid===p.authorId?(m(),_("li",{key:0,onClick:h=>t(r)(p.commentId,e.articleId,2)},"\u5220\u9664",8,Oe)):I("",!0)]),t(l)===p.commentId?(m(),k(R,{key:0,"article-id":e.articleId,level:2,"poster-comment-id":e.commentId,"reply-author-id":p.authorId,background:"white",onReQueryComments:i[0]||(i[0]=h=>s.$emit("reQueryComments"))},null,8,["article-id","poster-comment-id","reply-author-id"])):I("",!0)]))),256)),t(d)?(m(),_("span",{key:0,onClick:i[1]||(i[1]=(...p)=>t(f)&&t(f)(...p)),class:"pointer showMore"},"\u663E\u793A\u5168\u90E8...")):I("",!0)]))}});const Ge=E(We,[["__scopeId","data-v-44130ded"]]),Je={class:"comments-container content-card"},Xe={class:"tip"},Ye={key:0,class:"comments-list mt-20 content-card"},Ze={class:"comment-item"},et={class:"comment-content line-4"},tt={class:"list-style-init flex operator"},ot=["onClick"],nt=["onClick"],st=b({__name:"comments",props:{data:null,articleId:null,total:null,commentsTotal:null},emits:["pageNumChange","reQueryComments"],setup(e,{emit:o}){const{currenId:u,reply:l,userInfo:a,remove:c}=G(o);return(r,d)=>{const f=J;return m(),_("div",Je,[n("span",Xe,"\u8BC4\u8BBA/\u56DE\u590D\u5171 "+v(t(N)(e.total))+" \u6761",1),e.data.length?(m(),_("div",Ye,[(m(!0),_(L,null,H(e.data,s=>(m(),_("div",Ze,[y(j,{"user-info":s.authorInfo,"publish-time":s.createTime},null,8,["user-info","publish-time"]),n("p",et,v(s.content),1),n("ul",tt,[n("li",{class:"mr-10",onClick:i=>t(l)(s.commentId)},"\u56DE\u590D",8,ot),t(a).uid===s.authorId?(m(),_("li",{key:0,onClick:i=>t(c)(s.commentId,e.articleId,1)},"\u5220\u9664",8,nt)):I("",!0)]),t(u)===s.commentId?(m(),k(R,{key:0,"article-id":e.articleId,level:2,"poster-comment-id":s.commentId,onReQueryComments:d[0]||(d[0]=i=>r.$emit("reQueryComments")),"reply-author-id":s.authorId},null,8,["article-id","poster-comment-id","reply-author-id"])):I("",!0),s.children.length?(m(),k(Ge,{key:1,data:s.children,"comment-id":s.commentId,"article-id":e.articleId,onReQueryComments:d[1]||(d[1]=i=>r.$emit("reQueryComments"))},null,8,["data","comment-id","article-id"])):I("",!0)]))),256)),y(f,{background:"",layout:"prev, pager, next",total:e.commentsTotal,class:"mt-4",onCurrentChange:d[2]||(d[2]=s=>r.$emit("pageNumChange",s))},null,8,["total"])])):(m(),k(ee,{key:1,title:"\u8FD8\u6CA1\u6709\u4EBA\u53D1\u8868\u8BC4\u8BBA..."}))])}}});const ut=E(st,[["__scopeId","data-v-48b6c6db"]]);function it(e){const o=U({title:"",content:"",professional:"",authorId:0,likes:[],commentTotal:0,hot:0,createTime:"",updateTime:"",articleId:e.value,introduce:"",authorInfo:ce,comments:[]}),u=g(0),l=g(0),a=U({pageNum:1,pageSize:10,articleId:e.value});async function c(){if(!e.value){$("\u51FA\u9519\u4E86");return}const i=await pe({articleId:e.value});i.code==200&&at(o,i.data)}async function r(){a.articleId=e.value;const i=await ve(a);i.code==200&&(o.comments=i.data,u.value=i.total,l.value=i.commentsTotal)}function d(i){a.pageNum=i}async function f(i){if(!V())return $("\u8BF7\u5148\u767B\u5F55");if(i){x("\u70B9\u8FC7\u8D5E\u4E86, \u4E0D\u7528\u518D\u70B9\u4E86\uFF5E");return}const{userInfo:p}=T(),{code:h}=await _e({articleId:e.value,userId:p.uid});h==200&&o.likes.push(p.uid)}const s=W(function(){isNaN(e.value)||(r(),c())});return z(s),K(()=>e.value,()=>{s()}),ae(()=>o.content=""),{total:u,commentsTotal:l,article:o,like:f,queryArticle:c,pageNumChange:d,queryComments:r}}function at(e,o){e.articleId=o.articleId,e.title=o.title,e.content=o.content,e.commentTotal=o.commentTotal,e.professional=o.professional,e.authorId=o.authorId,e.likes=o.likes,e.createTime=o.createTime,e.updateTime=o.updateTime,e.introduce=o.introduce,e.authorInfo=o.authorInfo}function lt(e){const o=g(!1);function u(){o.value=!1,setTimeout(()=>o.value=!0,200)}return z(()=>{u()}),K(()=>e.value,()=>{u()}),{delay:o}}const D=e=>(Q("data-v-0c9695d5"),e=e(),S(),e),rt={class:"community-detail flex"},ct={class:"main-content mr-20"},mt={class:"main content-card"},dt=["innerHTML"],pt={class:"supports mb-20"},_t=D(()=>n("i",{class:"iconfont icon-like font-20"},null,-1)),ft=D(()=>n("i",{class:"iconfont icon-comment font-20"},null,-1)),ht=D(()=>n("i",{class:"iconfont icon-share font-20"},null,-1)),yt=D(()=>n("i",{class:"iconfont icon-edit font-20"},null,-1)),vt={class:"pointer tag mr-20"},It={class:"slide-content"},Ct=b({__name:"communityDetail",setup(e){const o=de(),u=M(()=>parseInt(o.query.articleId)),{userInfo:l}=T(),{article:a,total:c,commentsTotal:r,like:d,pageNumChange:f,queryComments:s}=it(u),{delay:i}=lt(u),p=M(()=>a.likes.includes(l.uid)),h=M(()=>a.authorId==l.uid);return(A,C)=>{const P=X;return m(),_("div",rt,[n("div",ct,[n("div",mt,[y(j,{class:"user-info","user-info":t(a).authorInfo,"publish-time":t(a).createTime},null,8,["user-info","publish-time"]),n("article",{class:"content",innerHTML:t(a).content},null,8,dt),n("div",pt,[n("span",{onClick:C[0]||(C[0]=w=>t(d)(t(p))),class:le({clicked:t(p)})},[_t,B(" "+v(t(N)(t(a).likes.length)),1)],2),n("span",null,[ft,B(" "+v(t(N)(t(a).comments.length)),1)]),n("span",null,[y(P,{placement:"bottom",content:"\u5206\u4EAB\u7ED9\u670B\u53CB"},{default:q(()=>[ht]),_:1})]),t(h)?(m(),_("span",{key:0,onClick:C[1]||(C[1]=w=>A.$router.push(`/community/editor?articleId=${t(u)}`))},[y(P,{placement:"bottom",content:"\u7F16\u8F91"},{default:q(()=>[yt]),_:1})])):I("",!0)]),n("span",vt,"#"+v(t(a).professional),1),n("span",{class:"pointer hover",onClick:C[2]||(C[2]=w=>A.$router.back())},"\u8FD4\u56DE\u4E0A\u4E00\u9875"),n("span",{class:"pointer hover back absolute",onClick:C[3]||(C[3]=w=>A.$router.back())},"\u8FD4\u56DE\u4E0A\u4E00\u9875")]),y(R,{"article-id":t(u),level:1,onReQueryComments:t(s)},null,8,["article-id","onReQueryComments"]),y(ut,{data:t(a).comments,"article-id":t(u),total:t(c),"comments-total":t(r),onPageNumChange:t(f),onReQueryComments:t(s)},null,8,["data","article-id","total","comments-total","onPageNumChange","onReQueryComments"])]),n("div",It,[y(te,{class:"slide-item"}),y(oe),t(i)?(m(),k(t(me),{key:0,class:"slide-item menu-bar content-card",body:".content",width:"200px"})):I("",!0)])])}}});const Kt=E(Ct,[["__scopeId","data-v-0c9695d5"]]);export{Kt as default};
